<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<title>Inventory Report Editor</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    padding:15px;
    background:#f4f4f4;
}

/* Container */
.container{
    max-width:1000px;
    margin:auto;
    background:#fff;
    padding:15px;
}

/* Make table scrollable on small screens */
.table-wrapper{
    overflow-x:auto;
}

/* Title */
h2{
    text-align:center;
    font-size:20px;
    text-transform:uppercase;
    margin-bottom:15px;
}

/* Table */
table{
    width:100%;
    border-collapse:collapse;
    table-layout:fixed;
}

th,td{
    border:2px solid #000;
    padding:8px;
    word-wrap:break-word;
}

th{
    background:#9fb6cc;
    text-align:center;
}

/* Column widths */
.details-col{
    width:55%;
}

.device-col{
    width:20%;
    text-align:center;
}

.action-col{
    width:25%;
    text-align:center;
}

/* Inputs */
input{
    width:100%;
    border:none;
    font-size:14px;
    outline:none;
    background:transparent;
    white-space:normal;
}

.device-col input{
    text-align:center;
    font-weight:bold;
    font-size:16px;
}

/* Remove number arrows */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button{
    -webkit-appearance:none;
    margin:0;
}
input[type=number]{
    -moz-appearance:textfield;
}

/* Total row */
.total-row td{
    font-weight:bold;
    font-size:16px;
    background:#e5e5e5;
}

/* Buttons */
button{
    padding:5px 8px;
    border:none;
    border-radius:4px;
    cursor:pointer;
    color:white;
    font-weight:bold;
    font-size:12px;
}

.btn-insert{ background:#28a745; }
.btn-delete{ background:#dc3545; }
.btn-save{ background:#007bff; }
.btn-reset{ background:#6c757d; }

.controls{
    text-align:center;
    margin-top:15px;
}

/* Export hide */
.exporting .action-col{
    display:none;
}

/* MOBILE EXTRA ADJUST */
@media (max-width:600px){
    h2{
        font-size:16px;
    }
    th,td{
        padding:6px;
        font-size:12px;
    }
    .device-col input{
        font-size:14px;
    }
}
</style>
</head>

<body>

<div class="container" id="report-area">
<h2 id="report-title"></h2>

<div class="table-wrapper">
<table>

<thead>
<tr>
<th class="details-col">DETAILS</th>
<th class="device-col">DEVICE</th>
<th class="action-col">ACTION</th>
</tr>
</thead>

<tbody id="inventory-body"></tbody>

<tfoot>
<tr class="total-row">
<td>Total Sum of Telematics</td>
<td id="total-sum" class="device-col">0</td>
<td class="action-col"></td>
</tr>
</tfoot>

</table>
</div>
</div>

<div class="controls">
<button class="btn-save" onclick="exportToJPG()">Save as JPG</button>
<button class="btn-reset" onclick="clearData()">Clear Cache</button>
</div>

<script>

/* AUTO DATE */
function setAutoTitle(){
    const now = new Date();
    const day = String(now.getDate()).padStart(2,'0');
    const month = String(now.getMonth()+1).padStart(2,'0');
    const year = now.getFullYear();

    const hours = now.getHours();
    let shift = hours>=6 && hours<14 ? "A-SHIFT" :
                hours>=14 && hours<22 ? "B-SHIFT" : "C-SHIFT";

    document.getElementById("report-title").innerText =
    `INVENTORY REPORT AS ON DTD:-${day}-${month}-${year} ${shift}`;
}

/* STANDARD ROWS */
const standardRows = [
"In hand stock",
"Lost device",
"Damaged Device",
"Devices in transit",
"Devices received at Barbil Plant",
"Stock devices in Gandhamardhan",
"Stock devices in Guali",
"Stock devices in Jilling",
"Stock devices in Khandbandh",
"Stock devices in Unchabali"
];

function createRow(text="", value=0){
    const row = document.createElement("tr");
    row.innerHTML = `
        <td><input type="text" value="${text}" oninput="saveData()"></td>
        <td class="device-col">
            <input type="number" class="count" value="${value}" min="0"
            oninput="calculateTotal(); saveData()">
        </td>
        <td class="action-col">
            <button class="btn-insert" onclick="insertRow(this)">+</button>
            <button class="btn-delete" onclick="deleteRow(this)">Ã—</button>
        </td>
    `;
    return row;
}

function insertRow(btn){
    btn.closest("tr").after(createRow(""));
    saveData();
}

function deleteRow(btn){
    btn.closest("tr").remove();
    calculateTotal();
    saveData();
}

function calculateTotal(){
    let total = 0;
    document.querySelectorAll(".count").forEach(inp=>{
        total += parseInt(inp.value) || 0;
    });
    document.getElementById("total-sum").innerText = total;
}

function saveData(){
    const rows = [];
    document.querySelectorAll("#inventory-body tr").forEach(row=>{
        const text = row.querySelector("td input[type=text]").value;
        const value = row.querySelector(".count").value;
        rows.push({text,value});
    });
    localStorage.setItem("inventoryData", JSON.stringify(rows));
}

function loadData(){
    setAutoTitle();
    const saved = localStorage.getItem("inventoryData");
    const tbody = document.getElementById("inventory-body");
    tbody.innerHTML = "";

    if(saved){
        JSON.parse(saved).forEach(r=>{
            tbody.appendChild(createRow(r.text, r.value));
        });
    } else {
        standardRows.forEach(text=>{
            tbody.appendChild(createRow(text,0));
        });
    }
    calculateTotal();
}

function clearData(){
    if(confirm("Clear saved inventory data?")){
        localStorage.removeItem("inventoryData");
        location.reload();
    }
}

function exportToJPG(){
    const element = document.getElementById("report-area");
    element.classList.add("exporting");

    html2canvas(element,{ scale:3 }).then(canvas=>{
        const link = document.createElement("a");
        link.download = "Inventory_Report.jpg";
        link.href = canvas.toDataURL("image/jpeg",1.0);
        link.click();
        element.classList.remove("exporting");
    });
}

window.onload = loadData;

</script>

</body>
</html>
